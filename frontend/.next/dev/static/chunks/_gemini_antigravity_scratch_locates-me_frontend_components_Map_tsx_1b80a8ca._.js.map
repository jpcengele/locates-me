{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/jpce/.gemini/antigravity/scratch/locates-me/frontend/components/Map.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { MapContainer, TileLayer, Marker, useMap, useMapEvents } from 'react-leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport L from 'leaflet';\n\n// Fix Leaflet icon issue in Next.js\nconst icon = L.icon({\n    iconUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png\",\n    iconRetinaUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png\",\n    shadowUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png\",\n    iconSize: [25, 41],\n    iconAnchor: [12, 41],\n});\n\n// Component to handle map events and updates\nfunction MapController({\n    onMove,\n    center\n}: {\n    onMove: (lat: number, lon: number) => void,\n    center: { lat: number, lon: number }\n}) {\n    const map = useMap();\n\n    // Update center when prop changes\n    useEffect(() => {\n        map.setView([center.lat, center.lon], map.getZoom());\n    }, [center, map]);\n\n    useMapEvents({\n        mousemove: (e) => {\n            onMove(e.latlng.lat, e.latlng.lng);\n        },\n        moveend: () => {\n            const c = map.getCenter();\n            onMove(c.lat, c.lng);\n        }\n    });\n\n    return null;\n}\n\nexport default function MapComponent() {\n    const [center, setCenter] = useState({ lat: 37.7749, lon: -122.4194 });\n    const [cursorLoc, setCursorLoc] = useState<{ lat: number, lon: number } | null>(null);\n    const [address, setAddress] = useState<string>(\"Hover map to see address\");\n    const [loading, setLoading] = useState(false);\n    const [searchInput, setSearchInput] = useState(\"\");\n    const [searchError, setSearchError] = useState(\"\");\n\n    const fetchAddress = useCallback(async (lat: number, lon: number) => {\n        try {\n            setLoading(true);\n            const res = await fetch(`http://localhost:8000/encode?lat=${lat}&lon=${lon}&lang=en`);\n            if (res.ok) {\n                const data = await res.json();\n                setAddress(data.words);\n            }\n        } catch (e) {\n            setAddress(\"Error connecting to API\");\n        } finally {\n            setLoading(false);\n        }\n    }, []);\n\n    // Debounce mouse move\n    useEffect(() => {\n        if (!cursorLoc) return;\n        const timer = setTimeout(() => {\n            fetchAddress(cursorLoc.lat, cursorLoc.lon);\n        }, 100);\n        return () => clearTimeout(timer);\n    }, [cursorLoc, fetchAddress]);\n\n    const handleSearch = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setSearchError(\"\");\n        const input = searchInput.trim();\n        if (!input) return;\n\n        // 1. Try Locates.me Address (Word.Word...)\n        if (input.includes('.') && input.split('.').length >= 3) {\n            try {\n                const res = await fetch(`http://localhost:8000/resolve?address=${input}&lang=en`);\n                if (res.ok) {\n                    const data = await res.json();\n                    setCenter({ lat: data.lat, lon: data.lon });\n                    setCursorLoc({ lat: data.lat, lon: data.lon }); // Update address display too\n                    return;\n                }\n            } catch (e) {\n                console.error(e);\n            }\n        }\n\n        // 2. Try Lat, Lon\n        if (input.includes(',')) {\n            const parts = input.split(',');\n            if (parts.length === 2) {\n                const lat = parseFloat(parts[0]);\n                const lon = parseFloat(parts[1]);\n                if (!isNaN(lat) && !isNaN(lon)) {\n                    setCenter({ lat, lon });\n                    setCursorLoc({ lat, lon });\n                    return;\n                }\n            }\n        }\n\n        // 3. Try OSM Nominatim (Place Search)\n        try {\n            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(input)}`);\n            if (res.ok) {\n                const data = await res.json();\n                if (data && data.length > 0) {\n                    const lat = parseFloat(data[0].lat);\n                    const lon = parseFloat(data[0].lon);\n                    setCenter({ lat, lon });\n                    setCursorLoc({ lat, lon });\n                    return;\n                } else {\n                    setSearchError(\"Location not found\");\n                }\n            }\n        } catch (e) {\n            setSearchError(\"Search failed\");\n        }\n    };\n\n    return (\n        <div className=\"w-full h-screen relative\">\n            <MapContainer\n                center={[center.lat, center.lon]}\n                zoom={14}\n                style={{ height: \"100%\", width: \"100%\" }}\n            >\n                <TileLayer\n                    attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n                    url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n                />\n                <Marker position={[center.lat, center.lon]} icon={icon} />\n                <MapController\n                    center={center}\n                    onMove={(lat, lon) => setCursorLoc({ lat, lon })}\n                />\n            </MapContainer>\n\n            {/* Search Bar */}\n            <div className=\"absolute top-4 left-1/2 transform -translate-x-1/2 z-[1000] w-[90%] max-w-md\">\n                <form onSubmit={handleSearch} className=\"flex shadow-xl rounded-full overflow-hidden\">\n                    <input\n                        type=\"text\"\n                        value={searchInput}\n                        onChange={(e) => setSearchInput(e.target.value)}\n                        placeholder=\"Search place, lat,lon, or address...\"\n                        className=\"flex-1 px-6 py-3 bg-white text-gray-800 focus:outline-none\"\n                    />\n                    <button type=\"submit\" className=\"bg-blue-600 text-white px-6 py-3 font-bold hover:bg-blue-700 transition\">\n                        FIND\n                    </button>\n                </form>\n                {searchError && (\n                    <div className=\"bg-red-500 text-white text-xs px-4 py-1 rounded-full mt-2 text-center shadow-lg inline-block\">\n                        {searchError}\n                    </div>\n                )}\n            </div>\n\n            {/* Address Display */}\n            <div className=\"absolute bottom-10 left-1/2 transform -translate-x-1/2 z-[1000] bg-white/90 backdrop-blur-md p-6 rounded-2xl shadow-2xl border border-gray-200 text-center min-w-[300px]\">\n                <h2 className=\"text-sm uppercase tracking-widest text-gray-500 mb-1\">Locates.me Address</h2>\n                <div className=\"text-2xl font-bold text-gray-900 font-mono\">\n                    {loading ? <span className=\"opacity-50\">...</span> : address}\n                </div>\n                {cursorLoc && (\n                    <div className=\"text-xs text-gray-400 mt-2\">\n                        {cursorLoc.lat.toFixed(6)}, {cursorLoc.lon.toFixed(6)}\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}